<!DOCTYPE html>
<html>
<head>
    <title>Items Database</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <style>
        th { cursor: pointer; }
        .sort-asc::after { content: " ↑"; }
        .sort-desc::after { content: " ↓"; }
        .table-responsive { margin-top: 2rem; }
        th:hover { background-color: #f3f4f6; }
    </style>
    <script src="items.js"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-6xl mx-auto">
        <div class="bg-white rounded-lg shadow p-6">
            <h1 class="text-2xl font-bold mb-4">Equipment Database</h1>
            <div id="tablesContainer"></div>
        </div>
    </div>

    <script>
        // Store original grouped items to preserve order
        const originalGroupedItems = {};
        
        function formatNumber(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        function getMainType(item) {
            return item.type.includes('Equipment-') ? 
                item.type.split('Equipment-')[1] : item.type;
        }

        function createTableForType(type, typeItems) {
            const sortState = window[`sortState_${type}`] || { column: -1, direction: '' };
            
            return `
                <div class="table-responsive">
                    <table class="w-full border-collapse" id="${type.toLowerCase()}-table">
                        <thead>
                            <tr class="bg-gray-50">
                                <th class="p-3 text-left border cursor-pointer" style="width:25%;" onclick="sortTable('${type}', 0)">
                                    ${type}
                                    ${sortState.column === 0 ? (sortState.direction === 'asc' ? ' ↑' : ' ↓') : ''}
                                </th>
                                <th class="p-3 text-center border cursor-pointer" style="width:8%;" onclick="sortTable('${type}', 1)">
                                    Attack
                                    ${sortState.column === 1 ? (sortState.direction === 'asc' ? ' ↑' : ' ↓') : ''}
                                </th>
                                <th class="p-3 text-center border cursor-pointer" style="width:8%;" onclick="sortTable('${type}', 2)">
                                    Strength
                                    ${sortState.column === 2 ? (sortState.direction === 'asc' ? ' ↑' : ' ↓') : ''}
                                </th>
                                <th class="p-3 text-center border cursor-pointer" style="width:8%;" onclick="sortTable('${type}', 3)">
                                    Defence
                                    ${sortState.column === 3 ? (sortState.direction === 'asc' ? ' ↑' : ' ↓') : ''}
                                </th>
                                <th class="p-3 text-center border cursor-pointer" style="width:8%;" onclick="sortTable('${type}', 4)">
                                    Health
                                    ${sortState.column === 4 ? (sortState.direction === 'asc' ? ' ↑' : ' ↓') : ''}
                                </th>
                                <th class="p-3 text-left border cursor-pointer" style="width:33%;" onclick="sortTable('${type}', 5)">
                                    Details
                                    ${sortState.column === 5 ? (sortState.direction === 'asc' ? ' ↑' : ' ↓') : ''}
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            ${typeItems.map(item => `
                                <tr class="hover:bg-gray-50">
                                    <td class="p-3 border">
                                        <span class="font-medium">${item.name}</span>
                                        ${item.rarity !== 'Common' ? `<span class="ml-2 text-sm text-gray-500">(${item.rarity})</span>` : ''}
                                    </td>
                                    <td class="p-3 border text-center">${formatNumber(parseInt(item.attackBonus) || 0)}</td>
                                    <td class="p-3 border text-center">${formatNumber(parseInt(item.strengthBonus) || 0)}</td>
                                    <td class="p-3 border text-center">${formatNumber(parseInt(item.defenceBonus) || 0)}</td>
                                    <td class="p-3 border text-center">${formatNumber(parseInt(item.healthBonus) || 0)}</td>
                                    <td class="p-3 border">
                                        ${item.description}
                                        ${parseInt(item.value) > 0 ? `<div class="text-sm text-gray-500">Value: ${formatNumber(parseInt(item.value))}</div>` : ''}
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        function populateTables() {
            // Group items by type
            items.forEach(item => {
                const mainType = getMainType(item);
                if (!originalGroupedItems[mainType]) {
                    originalGroupedItems[mainType] = [];
                }
                originalGroupedItems[mainType].push({...item});
            });

            // Initialize sort states for each type
            Object.keys(originalGroupedItems).forEach(type => {
                window[`sortState_${type}`] = { column: -1, direction: '' };
            });

            const container = document.getElementById('tablesContainer');
            container.innerHTML = Object.entries(originalGroupedItems)
                .sort(([typeA], [typeB]) => typeA.localeCompare(typeB))
                .map(([type, typeItems]) => createTableForType(type, typeItems))
                .join('');
        }

        function sortTable(type, column) {
            console.log(`Sorting ${type} table, column ${column}`);
            
            // Get or initialize sort state for this table
            const sortStateKey = `sortState_${type}`;
            if (!window[sortStateKey]) {
                window[sortStateKey] = { column: -1, direction: '' };
            }
            const sortState = window[sortStateKey];
            
            // Determine new sort direction
            if (sortState.column !== column) {
                // New column clicked - start with descending
                sortState.column = column;
                sortState.direction = 'desc';
            } else {
                // Same column clicked - cycle through states
                if (sortState.direction === 'desc') {
                    sortState.direction = 'asc';
                } else if (sortState.direction === 'asc') {
                    sortState.column = -1;
                    sortState.direction = '';
                } else {
                    sortState.direction = 'desc';
                }
            }
            
            console.log('Sort state:', sortState);

            // Get items for this type
            let typeItems = [...originalGroupedItems[type]];

            // Sort items if we have a sort direction
            if (sortState.direction) {
                typeItems.sort((a, b) => {
                    let result;
                    
                    switch(column) {
                        case 0: // Name
                            result = a.name.toLowerCase().localeCompare(b.name.toLowerCase());
                            break;
                        case 5: // Value (in Details column)
                            result = (parseInt(a.value) || 0) - (parseInt(b.value) || 0);
                            break;
                        default: // Other numeric columns
                            const props = ['attackBonus', 'strengthBonus', 'defenceBonus', 'healthBonus'];
                            result = (parseInt(a[props[column - 1]]) || 0) - (parseInt(b[props[column - 1]]) || 0);
                    }
                    
                    return sortState.direction === 'asc' ? result : -result;
                });
                
                console.log(`Sorted ${type} items by ${column}:`, 
                    typeItems.map(item => column === 0 ? item.name : 
                        column === 5 ? item.value : 
                        item[['attackBonus', 'strengthBonus', 'defenceBonus', 'healthBonus'][column - 1]]
                    )
                );
            }

            // Update the table
            const table = document.getElementById(`${type.toLowerCase()}-table`);
            table.parentElement.outerHTML = createTableForType(type, typeItems);
        }

        // Initialize tables
        populateTables();
    </script>
</body>
</html>
